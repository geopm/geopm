#!/bin/bash
#  Copyright (c) 2015 - 2023, Intel Corporation
#  SPDX-License-Identifier: BSD-3-Clause
#

test_name=$(basename $0)
test_dir=$(dirname $0)
obj_dir=@abs_top_builddir@
lib_path=${obj_dir}/.libs
top_dir=@abs_top_srcdir@

test_class=$(echo ${test_name} | awk -F. '{print $1}')
scripts_dir=${top_dir}/scripts
service_dir=${top_dir}/service
lib_dir=${obj_dir}/.libs

export PYTHONPATH=${scripts_dir}:${service_dir}:${PYTHONPATH}
export LD_LIBRARY_PATH=${lib_dir}:@GEOPMD_LIBDIR@:${LD_LIBRARY_PATH}

# PYTHON is expected to be set when running make check. However, the default
# value may be used when invoking this script directly from the command line.
"${PYTHON:-python3}" ${scripts_dir}/test/${test_class}.py --verbose ${test_name} >& ${test_dir}/${test_name}.log
