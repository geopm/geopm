GEOPM AGENT TUTORIAL
====================

This directory contains a tutorial on extending the behavior of the
GEOPM runtime by creating an Agent.  The Agent is responsible for reading signals from the platform, adjusting controls on the platform, deciding how to aggregate data up the tree to parent Controller nodes, ...

TODO: describe the tree

This example uses the signals and
controls provided by ExampleIOGroup from the previous tutorial found
in $GEOPM_ROOT/tutorial/iogroup.

The ExampleAgent calculates the utilization and prints the result to standard output.

Distinguish between policies and controls, samples and signals.


TODO:
future tutorial extending the Agent to return something other than true
for ascend/descend


0. Agent Interface
------------------

Agents extend the Agent base class found in src/Agent.hpp.  The pure
virtual methods in this interface must be implemented by every Agent;
however, some methods may have empty or degenerate implementations.
Some methods of the Agent interact with the platform directly when the
Agent is acting at the leaf of the tree (level 0).  Other methods are
only used at higher levels to send data up and down the tree.

In addition to the interface methods, it may be useful to implement
several static methods for use during plugin registration: plugin_name(),
make_plugin(), policy_names(), and sample_names().

1. Initialization
-----------------

push signals and controls
init():



2. Policies
-----------

Policies are sent from the root of the tree down to the leaves.  The
Agents at each level in between distribute their policies to children
at each level. Finally, the policies are used to decide how to adjust
platform controls at the leaf level.  The policies for the
ExampleAgent are the high and low thresholds for utilization that will
trigger messages to be printed to the screen.

descend():

    Copies the policy from the parent into the vector for each child.
    A more sophisticated Agent could use samples coming up the tree as
    feedback to be able to assign slightly different policies to each
    child.  Note that the output vector is owned by the Controller
    and should not be resized by the Agent.

adjust_platform():

    If the utilization is out of bounds, the Agent uses the STDERR signal
    to print a warning.  Otherwise, it uses the STDOUT signal to print the current
    idle percent.


3. Samples
----------

Samples are collected at the leaf level and sent up the tree to the root.
The Agents at each level aggregate the samples from their children to be sent
up to their parent.  Samples can come directly from platform signals, or they may be
generated by the Agent.  The ExampleAgent generates system utilization as a percent
to be sent up the tree.

sample_platform():

    Collect time spent in each mode using the ExampleIOGroup signals
    USER_TIME, NICE_TIME, SYSTEM_TIME, and IDLE_TIME.  The utilization
    is calculated as the percentage of IDLE_TIME compared to the
    total.  Note that the output vector is owned by the Controller and
    should not be resized by the Agent.

ascend():

    The vector passed in contains a vector of samples from each child.
    For each sample being passed up to the next level in the tree,
    this method takes the average of the samples across children to
    create a single value.


4. Tracing and reporting
------------------------

Agents implement several methods that allow them to include additional
information in reports and traces.

trace_names():

    Sets the names of the columns to be added to the trace.  It is the
    responsibility of the Agent to make sure the number and order of
    these names match the values returned by trace_values().

trace_values():

    Fills in the output vector with the latest set of values to be
    inserted into the trace.  In this example, both the calculated
    samples that were sent up the tree as well as the measured signal
    values are added to the trace.

report_header():

    Adds key-value pairs to the top of the report.  In this example,
    the Agent adds XXXX

report_node():

    Adds key-value pairs of details for a single node.  In this example,
    the Agent adds the highest and lowest idle % seen on the node.

report_region():

    The ExampleAgent does not do any per-region analysis, so no region
    details are added to the report.  Agents that do track region
    information can use this method to extend the region sections of
    the report.

5. Control loop cadence
-----------------------

The Agent is responsible for deciding the cadence that the main loop
of the Controller will walk up and down the tree and interact with the
platform.  It controls the length of time the Controller will wait
after each cycle by implementing the wait() method.  In this example,
wait() uses the time of the previous call to make sure the Controller
cycles are close to 1 second, even if the work from one cycle takes
slightly more or less time than the previous one.


6. Set up registration on plugin load
-------------------------------------


7. Run with GEOPM
-----------------

Specify the ExampleAgent as the Agent for the Controller by setting
GEOPM_AGENT=example.  The name of the Agent should match the name
returned by plugin_name() used for registration.
